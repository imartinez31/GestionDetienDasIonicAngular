<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Ventas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-menu side="start" menuId="main-menu" contentId="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Menú</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item button routerLink="/home" routerDirection="root">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        <ion-label>Inicio</ion-label>
      </ion-item>
      <ion-item button routerLink="/products" routerDirection="root">
        <ion-icon name="cube-outline" slot="start"></ion-icon>
        <ion-label>Productos</ion-label>
      </ion-item>
      <ion-item button routerLink="/customers" routerDirection="root">
        <ion-icon name="people-outline" slot="start"></ion-icon>
        <ion-label>Clientes</ion-label>
      </ion-item>
      <ion-item button routerLink="/sales" routerDirection="root">
        <ion-icon name="cart-outline" slot="start"></ion-icon>
        <ion-label>Ventas</ion-label>
      </ion-item>
      <ion-item button routerLink="/reports" routerDirection="root">
        <ion-icon name="bar-chart-outline" slot="start"></ion-icon>
        <ion-label>Reportes</ion-label>
      </ion-item>
      <ion-item button (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        <ion-label>Cerrar Sesión</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-content [fullscreen]="true" id="main-content">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Nueva Venta</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Cliente</ion-label>
        <ion-select [(ngModel)]="selectedCustomer" placeholder="Seleccione un cliente">
          <ion-select-option *ngFor="let customer of customers" [value]="customer">
            {{ customer.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Productos Disponibles</ion-label>
        <ion-select placeholder="Seleccione un producto" (ionChange)="addToCart($event.detail.value)">
          <ion-select-option *ngFor="let product of products" [value]="product" [disabled]="product.quantity === 0">
            {{ product.name }} ({{ product.quantity }} disponibles) - ${{ product.salePrice | number:'1.2-2' }}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="cartItems.length > 0">
    <ion-card-header>
      <ion-card-title>Carrito de Compras</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let item of cartItems">
          <ion-label>
            <h2>{{ item.productName }}</h2>
            <p>${{ item.unitPrice | number:'1.2-2' }} x {{ item.quantity }} = ${{ item.subtotal | number:'1.2-2' }}</p>
          </ion-label>
          <ion-input 
            type="number" 
            [value]="item.quantity" 
            (ionChange)="updateQuantity(item, $event.detail.value)"
            min="1"
            style="width: 60px;">
          </ion-input>
          <ion-button slot="end" fill="clear" color="danger" (click)="removeFromCart(item)">
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
      <ion-item>
        <ion-label><strong>Total: ${{ total | number:'1.2-2' }}</strong></ion-label>
      </ion-item>
      <ion-button expand="block" (click)="processSale()" color="success">
        Procesar Venta
      </ion-button>
      <ion-button expand="block" fill="outline" (click)="clearCart()">
        Limpiar Carrito
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Historial de Ventas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="sales.length > 0">
        <ion-item *ngFor="let sale of sales">
          <ion-label>
            <h2>{{ sale.customerName }}</h2>
            <p>{{ sale.date | date:'short' }}</p>
            <p>{{ sale.items.length }} producto(s) - Total: ${{ sale.total | number:'1.2-2' }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
      <p *ngIf="sales.length === 0">No hay ventas registradas</p>
    </ion-card-content>
  </ion-card>
</ion-content>
