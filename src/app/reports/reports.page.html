<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Reportes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-menu side="start" menuId="main-menu" contentId="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Menú</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item button routerLink="/home" routerDirection="root">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        <ion-label>Inicio</ion-label>
      </ion-item>
      <ion-item button routerLink="/products" routerDirection="root">
        <ion-icon name="cube-outline" slot="start"></ion-icon>
        <ion-label>Productos</ion-label>
      </ion-item>
      <ion-item button routerLink="/customers" routerDirection="root">
        <ion-icon name="people-outline" slot="start"></ion-icon>
        <ion-label>Clientes</ion-label>
      </ion-item>
      <ion-item button routerLink="/sales" routerDirection="root">
        <ion-icon name="cart-outline" slot="start"></ion-icon>
        <ion-label>Ventas</ion-label>
      </ion-item>
      <ion-item button routerLink="/reports" routerDirection="root">
        <ion-icon name="bar-chart-outline" slot="start"></ion-icon>
        <ion-label>Reportes</ion-label>
      </ion-item>
      <ion-item button (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        <ion-label>Cerrar Sesión</ion-label>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<ion-content [fullscreen]="true" id="main-content">
  <ion-card>
    <ion-card-header>
      <ion-card-title>Resumen General</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-card color="primary">
              <ion-card-content>
                <h2>{{ totalSales | number:'1.2-2' }}</h2>
                <p>Total en Ventas</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
          <ion-col size="6">
            <ion-card color="success">
              <ion-card-content>
                <h2>{{ filteredSales.length }}</h2>
                <p>Ventas Realizadas</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6">
            <ion-card color="warning">
              <ion-card-content>
                <h2>{{ totalProducts }}</h2>
                <p>Productos</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
          <ion-col size="6">
            <ion-card color="tertiary">
              <ion-card-content>
                <h2>{{ totalCustomers }}</h2>
                <p>Clientes</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-card color="secondary">
              <ion-card-content>
                <h2>{{ totalItemsSold }}</h2>
                <p>Productos Vendidos</p>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Filtro por Fecha</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Fecha Inicio</ion-label>
        <ion-input type="date" [(ngModel)]="startDate" (ionChange)="onDateChange()"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Fecha Fin</ion-label>
        <ion-input type="date" [(ngModel)]="endDate" (ionChange)="onDateChange()"></ion-input>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Detalle de Ventas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="filteredSales.length > 0">
        <ion-item *ngFor="let sale of filteredSales">
          <ion-label>
            <h2>{{ sale.customerName }}</h2>
            <p>{{ sale.date | date:'short' }}</p>
            <p>
              <strong>{{ sale.items.length }} producto(s)</strong> - 
              Total: <strong>${{ sale.total | number:'1.2-2' }}</strong>
            </p>
            <ion-list>
              <ion-item *ngFor="let item of sale.items" lines="none">
                <ion-label>
                  <p>{{ item.productName }} - {{ item.quantity }} x ${{ item.unitPrice | number:'1.2-2' }} = ${{ item.subtotal | number:'1.2-2' }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-label>
        </ion-item>
      </ion-list>
      <p *ngIf="filteredSales.length === 0">No hay ventas en el período seleccionado</p>
    </ion-card-content>
  </ion-card>
</ion-content>
